<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AfroPerm — Калькулятор</title>
    
    <!-- PWA Meta -->
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://via.placeholder.com/192/000000/FFFFFF?text=AP">

    <!-- VK Bridge SDK -->
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            background-color: #ffffff;
            font-family: 'Inter', sans-serif;
            color: #111827;
            -webkit-font-smoothing: antialiased;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 40;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid #f3f4f6;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 3px;
            background: #e5e7eb;
            outline: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: #111827;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .minimal-check {
            appearance: none;
            width: 22px;
            height: 22px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
        }

        .minimal-check:checked {
            background: #111827;
            border-color: #111827;
        }

        .minimal-check:checked::after {
            content: '';
            position: absolute;
            left: 7px;
            top: 3px;
            width: 6px;
            height: 12px;
            border: solid white;
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }
    </style>
</head>
<body id="app-root">

    <!-- Header -->
    <div class="max-w-3xl mx-auto p-6 md:p-16 pb-0">
        <div class="flex justify-between items-start">
            <div class="space-y-1.5">
                <h1 class="text-[12px] font-medium uppercase tracking-[0.2em] text-gray-400 leading-tight">AfroPerm / Студия</h1>
                <p class="text-[9px] uppercase tracking-[0.2em] text-gray-300 font-medium leading-tight">плетения и обучения</p>
            </div>
            <button onclick="toggleModal(true)" class="text-[12px] font-bold uppercase tracking-widest border-b-2 border-gray-900 pb-1">Прайс и инфо</button>
        </div>
    </div>

    <!-- Sticky Price -->
    <div class="sticky-header mb-8 md:mb-16">
        <header class="p-6 md:px-16 md:py-10 max-w-3xl mx-auto">
            <div class="space-y-2">
                <p id="mode-title" class="text-[10px] uppercase tracking-widest text-gray-400 font-bold">Ориентировочная стоимость / Плетения</p>
                <div id="total-price" class="text-5xl md:text-7xl font-light tracking-tighter">0 ₽</div>
            </div>
        </header>
    </div>

    <main class="max-w-3xl mx-auto px-6 pb-32">
        <div class="flex space-x-12 border-b border-gray-100 mb-12 md:mb-16">
            <button onclick="changeMode('braiding')" id="tab-braiding" class="pb-4 md:pb-6 text-sm font-bold uppercase tracking-widest border-b-2 border-black transition-all">Плетение</button>
            <button onclick="changeMode('correction')" id="tab-correction" class="pb-4 md:pb-6 text-sm font-bold uppercase tracking-widest text-gray-400 border-b-2 border-transparent transition-all">Подплетение</button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-12 md:gap-20">
            <!-- Controls -->
            <div class="space-y-12 md:space-y-16">
                <div class="space-y-8">
                    <div class="flex justify-between items-baseline">
                        <label class="text-[12px] uppercase font-bold tracking-widest text-gray-400">Количество</label>
                        <span id="display-count" class="text-2xl font-medium">0 шт</span>
                    </div>
                    <input type="range" id="input-count" min="0" max="150" value="0">
                </div>

                <div id="section-length" class="space-y-8">
                    <div class="flex justify-between items-baseline">
                        <label class="text-[12px] uppercase font-bold tracking-widest text-gray-400">Длина дред</label>
                        <span id="display-length" class="text-2xl font-medium">0 см</span>
                    </div>
                    <input type="range" id="input-length" min="0" max="100" step="5" value="0">
                </div>
            </div>

            <!-- Extras -->
            <div class="space-y-12 md:space-y-16">
                <div class="space-y-8">
                    <h3 class="text-[12px] uppercase font-bold tracking-[0.2em] text-gray-900 border-b border-gray-100 pb-3">Дополнительно</h3>
                    
                    <!-- Braiding Extras -->
                    <div id="braiding-extras" class="space-y-6">
                        <div class="flex items-start space-x-4">
                            <input type="checkbox" id="check-blunt" class="minimal-check mt-1">
                            <div class="flex-1">
                                <label for="check-blunt" class="text-sm font-semibold block">Тупые кончики <span class="text-gray-400 ml-2">+50₽/шт</span></label>
                                <div id="panel-blunt" class="hidden mt-6">
                                    <input type="range" id="input-blunt" min="0" max="150" value="0">
                                    <div class="text-[10px] mt-2 font-bold text-gray-400 uppercase tracking-wider">Количество: <span id="val-blunt">0</span></div>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4 pt-4">
                            <input type="checkbox" id="check-fusion" class="minimal-check mt-1">
                            <div class="flex-1">
                                <label for="check-fusion" class="text-sm font-semibold block">Сращивание <span class="text-gray-400 ml-2">+50₽/шт</span></label>
                                <div id="panel-fusion" class="hidden mt-6">
                                    <input type="range" id="input-fusion" min="0" max="150" value="0">
                                    <div class="text-[10px] mt-2 font-bold text-gray-400 uppercase tracking-wider">Количество: <span id="val-fusion">0</span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Correction Extras -->
                    <div id="correction-extras" class="hidden space-y-6">
                        <div class="flex items-start space-x-4">
                            <input type="checkbox" id="check-corr-len" class="minimal-check mt-1">
                            <div class="flex-1">
                                <label for="check-corr-len" class="text-sm font-semibold block">Коррекция по длине <span class="text-gray-400 ml-2">+50₽/10см</span></label>
                                <div id="panel-corr-len" class="hidden mt-6 space-y-6">
                                    <input type="range" id="input-corr-len-count" min="0" max="150" value="0">
                                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">Для скольки: <span id="val-corr-len-count">0</span> шт</div>
                                    <input type="range" id="input-corr-len-val" min="0" max="100" step="10" value="0">
                                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">Длина коррекции: <span id="val-corr-len-val">0</span> см</div>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-start space-x-4 pt-4">
                            <input type="checkbox" id="check-root" class="minimal-check mt-1">
                            <div class="flex-1">
                                <label for="check-root" class="text-sm font-semibold block">Прикорневое валяние <span class="text-gray-400 ml-2">+30₽/шт</span></label>
                                <div id="panel-root" class="hidden mt-6">
                                    <input type="range" id="input-root" min="0" max="150" value="0">
                                    <div class="text-[10px] mt-2 font-bold text-gray-400 uppercase tracking-wider">Количество: <span id="val-root">0</span> шт</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pt-10 border-t border-gray-100 space-y-4">
                    <div class="flex justify-between text-[11px] uppercase font-bold tracking-widest text-gray-400">
                        <span>База за 1 шт</span>
                        <span id="res-base">0 ₽</span>
                    </div>
                    <div id="res-extra-row" class="hidden flex justify-between text-[11px] uppercase font-bold tracking-widest text-gray-900">
                        <span>Доп. услуги (итого)</span>
                        <span id="res-extra">0 ₽</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal -->
    <div id="modal-info" class="fixed inset-0 z-50 opacity-0 pointer-events-none transition-all duration-300 overflow-y-auto bg-white">
        <div class="max-w-3xl mx-auto p-6 md:p-16">
            <div class="flex justify-between items-center mb-16 md:mb-24">
                <h2 class="text-[12px] font-black uppercase tracking-[0.4em] text-gray-900">Прайс и информация</h2>
                <button onclick="toggleModal(false)" class="text-[12px] font-bold uppercase tracking-widest border-b-2 border-black pb-1">Закрыть</button>
            </div>

            <div class="space-y-20 md:space-y-24">
                <section class="space-y-10">
                    <div class="flex justify-between items-baseline border-b border-gray-100 pb-4">
                        <h3 class="text-[12px] uppercase font-bold tracking-[0.2em] text-gray-400">Плетение / База</h3>
                    </div>
                    <div class="grid grid-cols-1 gap-6">
                        <div class="flex justify-between"><span>/ До 10 см</span><span class="text-xl">300 ₽</span></div>
                        <div class="flex justify-between"><span>/ 11 – 20 см</span><span class="text-xl">500 ₽</span></div>
                        <div class="flex justify-between"><span>/ 21 – 30 см</span><span class="text-xl">700 ₽</span></div>
                        <div class="flex justify-between"><span>/ 31 – 40 см</span><span class="text-xl">900 ₽</span></div>
                        <div class="flex justify-between"><span>/ 41 – 50 см</span><span class="text-xl">1 100 ₽</span></div>
                    </div>
                </section>

                <section class="space-y-10">
                    <div class="flex justify-between items-baseline border-b border-gray-100 pb-4">
                        <h3 class="text-[12px] uppercase font-bold tracking-[0.2em] text-gray-400">Сервис и коррекция</h3>
                    </div>
                    <div class="grid grid-cols-1 gap-6">
                        <div class="flex justify-between"><span>/ Подплетение</span><span class="text-xl">150 ₽<small class="text-gray-400 ml-1">/шт</small></span></div>
                        <div class="flex justify-between"><span>/ Тупой кончик</span><span class="text-xl">50 ₽<small class="text-gray-400 ml-1">/шт</small></span></div>
                        <div class="flex justify-between"><span>/ Сращивание</span><span class="text-xl">50 ₽<small class="text-gray-400 ml-1">/шт</small></span></div>
                        <div class="flex justify-between"><span>/ Валяние корней</span><span class="text-xl">30 ₽<small class="text-gray-400 ml-1">/шт</small></span></div>
                        <div class="flex justify-between"><span>/ Коррекция тела</span><span class="text-xl">50 ₽<small class="text-gray-400 ml-1">/10см</small></span></div>
                        <div class="flex justify-between pt-4 border-t border-gray-50 text-gray-400 italic">
                            <span class="font-semibold text-gray-700">/ Стакан капучино</span>
                            <span class="uppercase tracking-widest text-[11px] font-bold">ваша улыбка</span>
                        </div>
                    </div>
                </section>

                <footer class="border-t border-gray-900 pt-20 pb-32 text-center space-y-6">
                    <p class="text-[10px] uppercase font-bold text-gray-400 tracking-[0.5em]">AfroPerm Studio</p>
                    <a href="tel:+79223503162" class="text-3xl md:text-5xl font-light tracking-tighter block">+7 (922) 350-31-62</a>
                </footer>
            </div>
        </div>
    </div>

    <script>
        // VK Bridge Init
        if (typeof vkBridge !== 'undefined') {
            vkBridge.send("VKWebAppInit");
        }

        // PWA Service Worker Reg
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(() => {});
            });
        }

        let mode = 'braiding';

        function toggleModal(show) {
            const m = document.getElementById('modal-info');
            if(show) {
                m.classList.remove('pointer-events-none', 'opacity-0');
                document.body.style.overflow = 'hidden';
            } else {
                m.classList.add('opacity-0', 'pointer-events-none');
                document.body.style.overflow = 'auto';
            }
        }

        function changeMode(newMode) {
            mode = newMode;
            document.getElementById('tab-braiding').className = mode === 'braiding' ? 'pb-4 md:pb-6 text-sm font-bold uppercase tracking-widest border-b-2 border-black transition-all' : 'pb-4 md:pb-6 text-sm font-bold uppercase tracking-widest text-gray-400 border-b-2 border-transparent transition-all';
            document.getElementById('tab-correction').className = mode === 'correction' ? 'pb-4 md:pb-6 text-sm font-bold uppercase tracking-widest border-b-2 border-black transition-all' : 'pb-4 md:pb-6 text-sm font-bold uppercase tracking-widest text-gray-400 border-b-2 border-transparent transition-all';
            
            document.getElementById('section-length').style.display = mode === 'braiding' ? 'block' : 'none';
            document.getElementById('braiding-extras').style.display = mode === 'braiding' ? 'block' : 'none';
            document.getElementById('correction-extras').style.display = mode === 'correction' ? 'block' : 'none';
            document.getElementById('mode-title').innerText = mode === 'braiding' ? 'Ориентировочная стоимость / Плетения' : 'Ориентировочная стоимость / Коррекции';
            calculate();
        }

        function calculate() {
            const count = parseInt(document.getElementById('input-count').value);
            document.getElementById('display-count').innerText = `${count} шт`;
            let basePricePerOne = 0;
            let extrasPrice = 0;

            if (mode === 'braiding') {
                const len = parseInt(document.getElementById('input-length').value);
                document.getElementById('display-length').innerText = `${len} см`;
                if (count > 0) {
                    basePricePerOne = 300;
                    if (len > 10) basePricePerOne += Math.ceil((len - 10) / 10) * 200;
                }
                if (document.getElementById('check-blunt').checked) {
                    document.getElementById('panel-blunt').classList.remove('hidden');
                    extrasPrice += parseInt(document.getElementById('input-blunt').value) * 50;
                    document.getElementById('val-blunt').innerText = document.getElementById('input-blunt').value;
                } else document.getElementById('panel-blunt').classList.add('hidden');
                
                if (document.getElementById('check-fusion').checked) {
                    document.getElementById('panel-fusion').classList.remove('hidden');
                    extrasPrice += parseInt(document.getElementById('input-fusion').value) * 50;
                    document.getElementById('val-fusion').innerText = document.getElementById('input-fusion').value;
                } else document.getElementById('panel-fusion').classList.add('hidden');
            } else {
                if (count > 0) basePricePerOne = 150;
                if (document.getElementById('check-corr-len').checked) {
                    document.getElementById('panel-corr-len').classList.remove('hidden');
                    const cCount = parseInt(document.getElementById('input-corr-len-count').value);
                    const cLen = parseInt(document.getElementById('input-corr-len-val').value);
                    document.getElementById('val-corr-len-count').innerText = cCount;
                    document.getElementById('val-corr-len-val').innerText = cLen;
                    extrasPrice += cCount * (cLen / 10 * 50);
                } else document.getElementById('panel-corr-len').classList.add('hidden');
                
                if (document.getElementById('check-root').checked) {
                    document.getElementById('panel-root').classList.remove('hidden');
                    const v = parseInt(document.getElementById('input-root').value);
                    document.getElementById('val-root').innerText = v;
                    extrasPrice += v * 30;
                } else document.getElementById('panel-root').classList.add('hidden');
            }

            const total = (count * basePricePerOne) + extrasPrice;
            document.getElementById('total-price').innerText = `${total.toLocaleString()} ₽`;
            document.getElementById('res-base').innerText = `${basePricePerOne} ₽`;
            
            const extraRow = document.getElementById('res-extra-row');
            if (extrasPrice > 0) {
                extraRow.classList.remove('hidden');
                document.getElementById('res-extra').innerText = `${extrasPrice.toLocaleString()} ₽`;
            } else extraRow.classList.add('hidden');
        }

        const controls = ['input-count', 'input-length', 'input-blunt', 'input-fusion', 'input-corr-len-count', 'input-corr-len-val', 'input-root', 'check-blunt', 'check-fusion', 'check-corr-len', 'check-root'];
        controls.forEach(id => document.getElementById(id).addEventListener('input', calculate));
        calculate();
    </script>
</body>
</html>
